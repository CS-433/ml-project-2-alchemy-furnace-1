INFO: Using device cuda
INFO: Network:
	3 input channels
	2 output channels (classes)
	Transposed conv upscaling
INFO: Creating dataset with 100 examples
INFO: Scanning mask files to determine unique values
  0%|          | 0/100 [00:00<?, ?it/s]  6%|▌         | 6/100 [00:00<00:01, 57.29it/s]100%|██████████| 100/100 [00:00<00:00, 932.00it/s]
INFO: Unique mask values: [0, 255]
INFO: Creating dataset with 100 examples
INFO: Scanning mask files to determine unique values
  0%|          | 0/100 [00:00<?, ?it/s]100%|██████████| 100/100 [00:00<00:00, 3109.29it/s]
INFO: Unique mask values: [0, 255]
INFO: Creating dataset with 100 examples
INFO: Scanning mask files to determine unique values
  0%|          | 0/100 [00:00<?, ?it/s]100%|██████████| 100/100 [00:00<00:00, 1258.82it/s]
INFO: Unique mask values: [0, 255]
INFO: Creating dataset with 100 examples
INFO: Scanning mask files to determine unique values
  0%|          | 0/100 [00:00<?, ?it/s]100%|██████████| 100/100 [00:00<00:00, 2460.85it/s]
INFO: Unique mask values: [0, 255]
INFO: Creating dataset with 100 examples
INFO: Scanning mask files to determine unique values
  0%|          | 0/100 [00:00<?, ?it/s]100%|██████████| 100/100 [00:00<00:00, 1195.60it/s]
INFO: Unique mask values: [0, 255]
INFO: Creating dataset with 50 examples
INFO: Scanning mask files to determine unique values
  0%|          | 0/50 [00:00<?, ?it/s]100%|██████████| 50/50 [00:00<00:00, 1335.57it/s]
INFO: Unique mask values: [0, 255]
/home/yifwang/anaconda3/envs/ada/lib/python3.11/site-packages/torch/utils/data/dataloader.py:617: UserWarning: This DataLoader will create 64 worker processes in total. Our suggested max number of worker in current system is 40, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(
wandb: Using wandb-core as the SDK backend.  Please refer to https://wandb.me/wandb-core for more information.
wandb: Currently logged in as: awakening (awakening-wyf). Use `wandb login --relogin` to force relogin
wandb: Tracking run with wandb version 0.18.7
wandb: Run data is saved locally in /home/yifwang/ml-project-2-alchemy-furnace-1/wandb/run-20241217_160724-krbvwm56
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run balmy-wind-101
wandb: ⭐️ View project at https://wandb.ai/awakening-wyf/U-Net
wandb: 🚀 View run at https://wandb.ai/awakening-wyf/U-Net/runs/krbvwm56
INFO: Starting training:
        Epochs:          45
        Batch size:      12
        Learning rate:   0.0003
        Training size:   500
        Validation size: 50
        Checkpoints:     True
        Device:          cuda
        Images scaling:  0.5
        Mixed Precision: False
    
Epoch 1/45:   0%|          | 0/500 [00:00<?, ?img/s]/home/yifwang/anaconda3/envs/ada/lib/python3.11/site-packages/torch/utils/data/dataloader.py:617: UserWarning: This DataLoader will create 64 worker processes in total. Our suggested max number of worker in current system is 40, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(
Epoch 1/45:   2%|▏         | 12/500 [00:05<03:50,  2.12img/s]Epoch 1/45:   2%|▏         | 12/500 [00:05<03:50,  2.12img/s, loss (batch)=2.26]Epoch 1/45:   5%|▍         | 24/500 [00:05<03:44,  2.12img/s, loss (batch)=1.95]Epoch 1/45:   7%|▋         | 36/500 [00:05<03:38,  2.12img/s, loss (batch)=1.78]Epoch 1/45:  10%|▉         | 48/500 [00:05<03:33,  2.12img/s, loss (batch)=1.52]Epoch 1/45:  12%|█▏        | 60/500 [00:05<03:27,  2.12img/s, loss (batch)=1.37]Epoch 1/45:  14%|█▍        | 72/500 [00:05<00:25, 16.77img/s, loss (batch)=1.37]Epoch 1/45:  14%|█▍        | 72/500 [00:05<00:25, 16.77img/s, loss (batch)=1.19]Epoch 1/45:  17%|█▋        | 84/500 [00:05<00:24, 16.77img/s, loss (batch)=1.08]Epoch 1/45:  19%|█▉        | 96/500 [00:05<00:24, 16.77img/s, loss (batch)=0.993]
Validation round:   0%|          | 0/4 [00:00<?, ?batch/s][A
Validation round:  25%|██▌       | 1/4 [00:01<00:03,  1.26s/batch][A
                                                                  [AINFO: Validation Dice score: 0.3622395396232605
INFO: Note: NumExpr detected 64 cores but "NUMEXPR_MAX_THREADS" not set, so enforcing safe limit of 16.
INFO: NumExpr defaulting to 16 threads.
Epoch 1/45:  22%|██▏       | 108/500 [00:17<01:07,  5.79img/s, loss (batch)=0.993]Epoch 1/45:  22%|██▏       | 108/500 [00:17<01:07,  5.79img/s, loss (batch)=0.99] Epoch 1/45:  24%|██▍       | 120/500 [00:17<01:05,  5.79img/s, loss (batch)=0.774]Epoch 1/45:  26%|██▋       | 132/500 [00:17<01:03,  5.79img/s, loss (batch)=0.819]Epoch 1/45:  29%|██▉       | 144/500 [00:17<01:01,  5.79img/s, loss (batch)=0.91] Epoch 1/45:  31%|███       | 156/500 [00:17<00:59,  5.79img/s, loss (batch)=0.773]Epoch 1/45:  34%|███▎      | 168/500 [00:17<00:28, 11.60img/s, loss (batch)=0.773]Epoch 1/45:  34%|███▎      | 168/500 [00:17<00:28, 11.60img/s, loss (batch)=0.803]Epoch 1/45:  36%|███▌      | 180/500 [00:17<00:27, 11.60img/s, loss (batch)=0.767]Epoch 1/45:  38%|███▊      | 192/500 [00:17<00:26, 11.60img/s, loss (batch)=0.817]
Validation round:   0%|          | 0/4 [00:00<?, ?batch/s][A/home/yifwang/anaconda3/envs/ada/lib/python3.11/site-packages/torch/utils/data/dataloader.py:617: UserWarning: This DataLoader will create 64 worker processes in total. Our suggested max number of worker in current system is 40, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.
  warnings.warn(

Validation round:  25%|██▌       | 1/4 [00:01<00:03,  1.06s/batch][A
                                                                  [AINFO: Validation Dice score: 0.36372682452201843
Epoch 1/45:  41%|████      | 204/500 [00:19<00:25, 11.60img/s, loss (batch)=0.693]Epoch 1/45:  43%|████▎     | 216/500 [00:19<00:19, 14.27img/s, loss (batch)=0.693]Epoch 1/45:  43%|████▎     | 216/500 [00:19<00:19, 14.27img/s, loss (batch)=0.701]Epoch 1/45:  46%|████▌     | 228/500 [00:19<00:19, 14.27img/s, loss (batch)=0.689]Epoch 1/45:  48%|████▊     | 240/500 [00:19<00:18, 14.27img/s, loss (batch)=0.7]  Epoch 1/45:  50%|█████     | 252/500 [00:19<00:17, 14.27img/s, loss (batch)=0.708]Epoch 1/45:  53%|█████▎    | 264/500 [00:19<00:16, 14.27img/s, loss (batch)=0.733]Epoch 1/45:  55%|█████▌    | 276/500 [00:19<00:09, 23.22img/s, loss (batch)=0.733]Epoch 1/45:  55%|█████▌    | 276/500 [00:19<00:09, 23.22img/s, loss (batch)=0.682]Epoch 1/45:  58%|█████▊    | 288/500 [00:19<00:09, 23.22img/s, loss (batch)=0.662]
Validation round:   0%|          | 0/4 [00:00<?, ?batch/s][A
Validation round:  25%|██▌       | 1/4 [00:01<00:03,  1.02s/batch][A
                                                                  [AINFO: Validation Dice score: 0.3660280108451843
Epoch 1/45:  60%|██████    | 300/500 [00:21<00:08, 23.22img/s, loss (batch)=0.604]Epoch 1/45:  62%|██████▏   | 312/500 [00:21<00:08, 23.22img/s, loss (batch)=0.637]Epoch 1/45:  65%|██████▍   | 324/500 [00:21<00:07, 24.45img/s, loss (batch)=0.637]Epoch 1/45:  65%|██████▍   | 324/500 [00:21<00:07, 24.45img/s, loss (batch)=0.641]Epoch 1/45:  67%|██████▋   | 336/500 [00:21<00:06, 24.45img/s, loss (batch)=0.87] Epoch 1/45:  70%|██████▉   | 348/500 [00:21<00:06, 24.45img/s, loss (batch)=0.694]Epoch 1/45:  72%|███████▏  | 360/500 [00:21<00:05, 24.45img/s, loss (batch)=0.618]Epoch 1/45:  74%|███████▍  | 372/500 [00:21<00:05, 24.45img/s, loss (batch)=0.679]Epoch 1/45:  77%|███████▋  | 384/500 [00:21<00:03, 37.16img/s, loss (batch)=0.679]Epoch 1/45:  77%|███████▋  | 384/500 [00:21<00:03, 37.16img/s, loss (batch)=0.537]
Validation round:   0%|          | 0/4 [00:00<?, ?batch/s][A
Validation round:  25%|██▌       | 1/4 [00:01<00:03,  1.02s/batch][A
                                                                  [AINFO: Validation Dice score: 0.3812565803527832
Epoch 1/45:  79%|███████▉  | 396/500 [00:23<00:02, 37.16img/s, loss (batch)=0.633]Epoch 1/45:  82%|████████▏ | 408/500 [00:23<00:02, 37.16img/s, loss (batch)=0.633]Epoch 1/45:  84%|████████▍ | 420/500 [00:23<00:02, 37.16img/s, loss (batch)=0.58] Epoch 1/45:  86%|████████▋ | 432/500 [00:23<00:02, 33.79img/s, loss (batch)=0.58]Epoch 1/45:  86%|████████▋ | 432/500 [00:23<00:02, 33.79img/s, loss (batch)=0.575]Epoch 1/45:  89%|████████▉ | 444/500 [00:23<00:01, 33.79img/s, loss (batch)=0.688]Epoch 1/45:  91%|█████████ | 456/500 [00:23<00:01, 33.79img/s, loss (batch)=0.56] Epoch 1/45:  94%|█████████▎| 468/500 [00:23<00:00, 33.79img/s, loss (batch)=0.567]Epoch 1/45:  96%|█████████▌| 480/500 [00:23<00:00, 33.79img/s, loss (batch)=0.633]
Validation round:   0%|          | 0/4 [00:00<?, ?batch/s][A
Validation round:  25%|██▌       | 1/4 [00:01<00:03,  1.02s/batch][A
                                                                  [AINFO: Validation Dice score: 0.36723196506500244
Epoch 1/45:  98%|█████████▊| 492/500 [00:25<00:00, 32.95img/s, loss (batch)=0.633]Epoch 1/45:  98%|█████████▊| 492/500 [00:25<00:00, 32.95img/s, loss (batch)=0.587]Epoch 1/45: 100%|██████████| 500/500 [00:25<00:00, 32.95img/s, loss (batch)=0.455]Epoch 1/45: 100%|██████████| 500/500 [00:25<00:00, 19.81img/s, loss (batch)=0.455]
Epoch 2/45:   0%|          | 0/500 [00:00<?, ?img/s]Epoch 2/45:   2%|▏         | 12/500 [00:00<00:40, 12.02img/s]Epoch 2/45:   2%|▏         | 12/500 [00:01<00:40, 12.02img/s, loss (batch)=0.443]Epoch 2/45:   5%|▍         | 24/500 [00:01<00:39, 12.02img/s, loss (batch)=0.507]Epoch 2/45:   7%|▋         | 36/500 [00:01<00:38, 12.02img/s, loss (batch)=0.499]Epoch 2/45:  10%|▉         | 48/500 [00:01<00:37, 12.02img/s, loss (batch)=0.551]Epoch 2/45:  12%|█▏        | 60/500 [00:01<00:36, 12.02img/s, loss (batch)=0.505]Epoch 2/45:  14%|█▍        | 72/500 [00:01<00:35, 12.02img/s, loss (batch)=0.644]
Validation round:   0%|          | 0/4 [00:00<?, ?batch/s][A
Validation round:  25%|██▌       | 1/4 [00:01<00:03,  1.03s/batch][A
                                                                  [AINFO: Validation Dice score: 0.46981072425842285
Epoch 2/45:  17%|█▋        | 84/500 [00:02<00:12, 33.00img/s, loss (batch)=0.644]Epoch 2/45:  17%|█▋        | 84/500 [00:02<00:12, 33.00img/s, loss (batch)=0.604]Epoch 2/45:  19%|█▉        | 96/500 [00:02<00:12, 33.00img/s, loss (batch)=0.502]Epoch 2/45:  22%|██▏       | 108/500 [00:02<00:11, 33.00img/s, loss (batch)=0.577]Epoch 2/45:  24%|██▍       | 120/500 [00:02<00:11, 33.00img/s, loss (batch)=0.536]Epoch 2/45:  26%|██▋       | 132/500 [00:02<00:11, 33.00img/s, loss (batch)=0.565]Epoch 2/45:  29%|██▉       | 144/500 [00:02<00:05, 64.38img/s, loss (batch)=0.565]Epoch 2/45:  29%|██▉       | 144/500 [00:02<00:05, 64.38img/s, loss (batch)=0.555]Epoch 2/45:  31%|███       | 156/500 [00:02<00:05, 64.38img/s, loss (batch)=0.505]Epoch 2/45:  34%|███▎      | 168/500 [00:02<00:05, 64.38img/s, loss (batch)=0.469]
Validation round:   0%|          | 0/4 [00:00<?, ?batch/s][A
Validation round:  25%|██▌       | 1/4 [00:01<00:03,  1.03s/batch][A
                                                                  [AINFO: Validation Dice score: 0.44127213954925537
Epoch 2/45:  36%|███▌      | 180/500 [00:04<00:08, 39.47img/s, loss (batch)=0.469]Epoch 2/45:  36%|███▌      | 180/500 [00:04<00:08, 39.47img/s, loss (batch)=0.558]Epoch 2/45:  38%|███▊      | 192/500 [00:04<00:07, 39.47img/s, loss (batch)=0.55] Epoch 2/45:  41%|████      | 204/500 [00:04<00:07, 39.47img/s, loss (batch)=0.478]Epoch 2/45:  43%|████▎     | 216/500 [00:04<00:07, 39.47img/s, loss (batch)=0.523]Epoch 2/45:  46%|████▌     | 228/500 [00:04<00:06, 39.47img/s, loss (batch)=0.591]Epoch 2/45:  48%|████▊     | 240/500 [00:04<00:03, 65.07img/s, loss (batch)=0.591]Epoch 2/45:  48%|████▊     | 240/500 [00:04<00:03, 65.07img/s, loss (batch)=0.374]Epoch 2/45:  50%|█████     | 252/500 [00:04<00:03, 65.07img/s, loss (batch)=0.412]Epoch 2/45:  53%|█████▎    | 264/500 [00:04<00:03, 65.07img/s, loss (batch)=0.45] 
Validation round:   0%|          | 0/4 [00:00<?, ?batch/s][A
Validation round:  25%|██▌       | 1/4 [00:01<00:03,  1.03s/batch][A
                                                                  [AINFO: Validation Dice score: 0.6889626979827881
Epoch 2/45:  55%|█████▌    | 276/500 [00:06<00:05, 38.21img/s, loss (batch)=0.45]Epoch 2/45:  55%|█████▌    | 276/500 [00:06<00:05, 38.21img/s, loss (batch)=0.44]Epoch 2/45:  58%|█████▊    | 288/500 [00:06<00:05, 38.21img/s, loss (batch)=0.494]Epoch 2/45:  60%|██████    | 300/500 [00:06<00:05, 38.21img/s, loss (batch)=0.547]Epoch 2/45:  62%|██████▏   | 312/500 [00:06<00:04, 38.21img/s, loss (batch)=0.497]Epoch 2/45:  65%|██████▍   | 324/500 [00:06<00:04, 38.21img/s, loss (batch)=0.482]Epoch 2/45:  67%|██████▋   | 336/500 [00:06<00:02, 59.91img/s, loss (batch)=0.482]Epoch 2/45:  67%|██████▋   | 336/500 [00:06<00:02, 59.91img/s, loss (batch)=0.468]Epoch 2/45:  70%|██████▉   | 348/500 [00:06<00:02, 59.91img/s, loss (batch)=0.426]Epoch 2/45:  72%|███████▏  | 360/500 [00:06<00:02, 59.91img/s, loss (batch)=0.488]
Validation round:   0%|          | 0/4 [00:00<?, ?batch/s][A
Validation round:  25%|██▌       | 1/4 [00:01<00:03,  1.04s/batch][A
                                                                  [AINFO: Validation Dice score: 0.7077615261077881
Epoch 2/45:  74%|███████▍  | 372/500 [00:16<00:10, 12.13img/s, loss (batch)=0.488]Epoch 2/45:  74%|███████▍  | 372/500 [00:16<00:10, 12.13img/s, loss (batch)=0.475]Epoch 2/45:  77%|███████▋  | 384/500 [00:16<00:09, 12.13img/s, loss (batch)=0.469]Epoch 2/45:  79%|███████▉  | 396/500 [00:16<00:08, 12.13img/s, loss (batch)=0.526]Epoch 2/45:  82%|████████▏ | 408/500 [00:16<00:07, 12.13img/s, loss (batch)=0.46] Epoch 2/45:  84%|████████▍ | 420/500 [00:16<00:06, 12.13img/s, loss (batch)=0.474]Epoch 2/45:  86%|████████▋ | 432/500 [00:16<00:03, 19.09img/s, loss (batch)=0.474]Epoch 2/45:  86%|████████▋ | 432/500 [00:16<00:03, 19.09img/s, loss (batch)=0.398]Epoch 2/45:  89%|████████▉ | 444/500 [00:17<00:02, 19.09img/s, loss (batch)=0.517]Epoch 2/45:  91%|█████████ | 456/500 [00:17<00:02, 19.09img/s, loss (batch)=0.43] 
Validation round:   0%|          | 0/4 [00:00<?, ?batch/s][A
Validation round:  25%|██▌       | 1/4 [00:01<00:03,  1.03s/batch][A
                                                                  [AINFO: Validation Dice score: 0.7530785202980042
Epoch 2/45:  94%|█████████▎| 468/500 [00:18<00:01, 19.09img/s, loss (batch)=0.489]Epoch 2/45:  96%|█████████▌| 480/500 [00:18<00:00, 20.89img/s, loss (batch)=0.489]Epoch 2/45:  96%|█████████▌| 480/500 [00:18<00:00, 20.89img/s, loss (batch)=0.5]  Epoch 2/45:  98%|█████████▊| 492/500 [00:18<00:00, 20.89img/s, loss (batch)=0.437]Epoch 2/45: 100%|██████████| 500/500 [00:18<00:00, 20.89img/s, loss (batch)=0.472]Epoch 2/45: 100%|██████████| 500/500 [00:18<00:00, 26.43img/s, loss (batch)=0.472]
Epoch 3/45:   0%|          | 0/500 [00:00<?, ?img/s]Epoch 3/45:   2%|▏         | 12/500 [00:01<00:41, 11.84img/s]Epoch 3/45:   2%|▏         | 12/500 [00:01<00:41, 11.84img/s, loss (batch)=0.45]Epoch 3/45:   5%|▍         | 24/500 [00:01<00:40, 11.84img/s, loss (batch)=0.482]Epoch 3/45:   7%|▋         | 36/500 [00:01<00:39, 11.84img/s, loss (batch)=0.382]Epoch 3/45:  10%|▉         | 48/500 [00:01<00:38, 11.84img/s, loss (batch)=0.393]
Validation round:   0%|          | 0/4 [00:00<?, ?batch/s][A
Validation round:  25%|██▌       | 1/4 [00:01<00:03,  1.04s/batch][A
                                                                  [AINFO: Validation Dice score: 0.7610808610916138
Epoch 3/45:  12%|█▏        | 60/500 [00:02<00:19, 22.69img/s, loss (batch)=0.393]Epoch 3/45:  12%|█▏        | 60/500 [00:02<00:19, 22.69img/s, loss (batch)=0.677]Epoch 3/45:  14%|█▍        | 72/500 [00:02<00:18, 22.69img/s, loss (batch)=0.403]Epoch 3/45:  14%|█▍        | 72/500 [00:02<00:16, 25.50img/s, loss (batch)=0.403]
Traceback (most recent call last):
  File "/home/yifwang/ml-project-2-alchemy-furnace-1/scripts/train.py", line 278, in <module>
    train_model(
  File "/home/yifwang/ml-project-2-alchemy-furnace-1/scripts/train.py", line 151, in train_model
    for batch in train_loader:
  File "/home/yifwang/anaconda3/envs/ada/lib/python3.11/site-packages/torch/utils/data/dataloader.py", line 701, in __next__
    data = self._next_data()
           ^^^^^^^^^^^^^^^^^
  File "/home/yifwang/anaconda3/envs/ada/lib/python3.11/site-packages/torch/utils/data/dataloader.py", line 1445, in _next_data
    return self._process_data(data)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/yifwang/anaconda3/envs/ada/lib/python3.11/site-packages/torch/utils/data/dataloader.py", line 1491, in _process_data
    data.reraise()
  File "/home/yifwang/anaconda3/envs/ada/lib/python3.11/site-packages/torch/_utils.py", line 715, in reraise
    raise exception
AssertionError: Caught AssertionError in DataLoader worker process 6.
Original Traceback (most recent call last):
  File "/home/yifwang/anaconda3/envs/ada/lib/python3.11/site-packages/torch/utils/data/_utils/worker.py", line 351, in _worker_loop
    data = fetcher.fetch(index)  # type: ignore[possibly-undefined]
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/yifwang/anaconda3/envs/ada/lib/python3.11/site-packages/torch/utils/data/_utils/fetch.py", line 52, in fetch
    data = [self.dataset[idx] for idx in possibly_batched_index]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/yifwang/anaconda3/envs/ada/lib/python3.11/site-packages/torch/utils/data/_utils/fetch.py", line 52, in <listcomp>
    data = [self.dataset[idx] for idx in possibly_batched_index]
            ~~~~~~~~~~~~^^^^^
  File "/home/yifwang/anaconda3/envs/ada/lib/python3.11/site-packages/torch/utils/data/dataset.py", line 350, in __getitem__
    return self.datasets[dataset_idx][sample_idx]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/yifwang/ml-project-2-alchemy-furnace-1/scripts/../utils/data_loading.py", line 98, in __getitem__
    assert len(img_file) == 1, f'Either no image or multiple images found for the ID {name}: {img_file}'
           ^^^^^^^^^^^^^^^^^^
AssertionError: Either no image or multiple images found for the ID satImage_004: []

